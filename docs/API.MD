## 📘 API 文件：多租戶 Agentic RAG 筆記平台

> ✅ 所有 API 都需帶上 JWT Token（透過 Firebase Auth），後端會驗證使用者身份並擷取 `user_id` 作為租戶依據。

---

### 🔐 Auth 認證

| 方法     | 路徑                   | 描述                                            |
| ------ | -------------------- | --------------------------------------------- |
| `POST` | `/auth/verify-token` | 驗證前端傳來的 Firebase Token，回傳使用者資訊與租戶標識（user\_id） |

---

### 📂 筆記上傳與管理

| 方法       | 路徑                           | 描述                                                            |
| -------- | ---------------------------- | ------------------------------------------------------------- |
| `GET`    | `/notes`                     | 取得目前使用者所有已上傳的筆記清單（含 metadata）                                 |
| `GET`    | `/notes/{note_id}`           | 查看單一筆記內容（可加上 includeChunks=true 取得分段內容）                       |
| `DELETE` | `/notes/{note_id}`           | 刪除某筆筆記與其對應的 chunks / 向量資料                                     |
| `POST`   | `/notes/{note_id}/reprocess` | 重新處理指定筆記（重新 chunk / embedding）                                |
| `PATCH`  | `/notes/{note_id}`           | 編輯筆記的標題或 metadata                                             |

---

### 🔍 搜尋與聊天

| 方法       | 路徑                  | 描述                                          |
| -------- | ------------------- | ------------------------------------------- |
| `POST`   | `/query`            | 傳入使用者提問，透過 RAG + Agentic pipeline 進行檢索與回答生成 |
| `GET`    | `/query/history`    | 取得使用者歷史問答紀錄                                 |
| `GET`    | `/query/{query_id}` | 查看某一則問答詳細內容與引用 chunks                       |
| `DELETE` | `/query/{query_id}` | 刪除歷史紀錄                                      |

---

### 🧠 Agentic 設定與調整

| 方法      | 路徑                  | 描述                                                      |
| ------- | ------------------- | ------------------------------------------------------- |
| `GET`   | `/agents/config`    | 取得目前 agent pipeline 的設定（如是否啟用反思、最大步數等）                  |
| `PATCH` | `/agents/config`    | 更新 agent pipeline 設定（例如變更使用的 LLM、是否啟用 validation agent） |
| `POST`  | `/agents/debug-run` | 使用自訂 prompt 測試 agent 流程（debug 用）                        |

---

### ⚙️ 系統與帳號設定

| 方法       | 路徑               | 描述                    |
| -------- | ---------------- | --------------------- |
| `GET`    | `/user/profile`  | 取得使用者基本資料             |
| `DELETE` | `/user/account`  | 刪除帳號與所有相關資料（需確認）      |
| `GET`    | `/system/status` | 查看系統狀態（向量庫連線、LLM 可用性） |
| `GET`    | `/logs`          | （僅限管理員）查看系統日誌／審計紀錄    |

---

### 📦 Embedding / 向量操作（可選擴充）

| 方法       | 路徑                 | 描述                           |
| -------- | ------------------ | ---------------------------- |
| `GET`    | `/vectors/summary` | 查看目前使用者已儲存向量總數、占用容量等統計       |
| `POST`   | `/vectors/search`  | 手動輸入 embedding 向量做查詢（測試／分析用） |
| `DELETE` | `/vectors/cleanup` | 清除所有已刪除筆記對應的向量（後台定時任務可自動執行）  |

---

## 🗂 前端頁面與 API 對應（對照）

| 頁面 Component    | 對應 API                                               |
| --------------- | ---------------------------------------------------- |
| `LoginPage`     | `/auth/verify-token`                                 |
| `NotesPage`     | `/notes`、`/notes/{note_id}`、`/notes/{id}/reprocess`  |
| `ChatPage`      | `/query`、`/query/history`、`/query/{id}`              |
| `HistoryPage`   | `/query/history`、`/query/{id}`、`/query/{id}`（DELETE） |
| `SettingsPage`  | `/user/profile`、`/user/account`、`/agents/config`     |
| `DashboardPage` | `/system/status`、`/vectors/summary`                  |

---